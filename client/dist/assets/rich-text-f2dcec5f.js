import{r as N}from"./fast-diff-e1d39b66.js";var v,g;function R(){return g||(g=1,v={equal:function(n,i){if(n===i||n==null&&i==null)return!0;if(n==null||i==null||Object.keys(n).length!=Object.keys(i).length)return!1;for(var f in n)if(n[f]!==i[f])return!1;return!0},array:function(n){return Array.isArray(n)},number:function(n){return typeof n=="number"||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Number]"},object:function(n){return n?typeof n=="function"||typeof n=="object":!1},string:function(n){return typeof n=="string"||typeof n=="object"&&Object.prototype.toString.call(n)==="[object String]"}}),v}var d,k;function E(){if(k)return d;k=1;var n=R(),i={attributes:{clone:function(u,s){return n.object(u)?Object.keys(u).reduce(function(e,t){return u[t]!==void 0&&(u[t]!==null||s)&&(e[t]=u[t]),e},{}):{}},compose:function(u,s,e){n.object(u)||(u={}),n.object(s)||(s={});var t=this.clone(s,e);for(var r in u)u[r]!==void 0&&s[r]===void 0&&(t[r]=u[r]);return Object.keys(t).length>0?t:void 0},diff:function(u,s){n.object(u)||(u={}),n.object(s)||(s={});var e=Object.keys(u).concat(Object.keys(s)).reduce(function(t,r){return u[r]!==s[r]&&(t[r]=s[r]===void 0?null:s[r]),t},{});return Object.keys(e).length>0?e:void 0},transform:function(u,s,e){if(!n.object(u))return s;if(n.object(s)){if(!e)return s;var t=Object.keys(s).reduce(function(r,o){return u[o]===void 0&&(r[o]=s[o]),r},{});return Object.keys(t).length>0?t:void 0}}},clone:function(u){var s=this.attributes.clone(u);return n.object(s.attributes)&&(s.attributes=this.attributes.clone(s.attributes,!0)),s},iterator:function(u){return new f(u)},length:function(u){return n.number(u.delete)?u.delete:n.number(u.retain)?u.retain:n.string(u.insert)?u.insert.length:1}};function f(u){this.ops=u,this.index=0,this.offset=0}return f.prototype.hasNext=function(){return this.peekLength()<1/0},f.prototype.next=function(u){u||(u=1/0);var s=this.ops[this.index];if(s){var e=this.offset,t=i.length(s);if(u>=t-e?(u=t-e,this.index+=1,this.offset=0):this.offset+=u,n.number(s.delete))return{delete:u};var r={};return s.attributes&&(r.attributes=s.attributes),n.number(s.retain)?r.retain=u:n.string(s.insert)?r.insert=s.insert.substr(e,u):r.insert=s.insert,r}else return{retain:1/0}},f.prototype.peekLength=function(){return this.ops[this.index]?i.length(this.ops[this.index])-this.offset:1/0},f.prototype.peekType=function(){return this.ops[this.index]?n.number(this.ops[this.index].delete)?"delete":n.number(this.ops[this.index].retain)?"retain":"insert":"retain"},d=i,d}var m,I;function D(){if(I)return m;I=1;var n=N(),i=R(),f=E(),u=String.fromCharCode(0),s=function(e){i.array(e)?this.ops=e:i.object(e)&&i.array(e.ops)?this.ops=e.ops:this.ops=[]};return s.prototype.insert=function(e,t){var r={};if(i.string(e)){if(e.length===0)return this;r.insert=e}else i.number(e)&&(r.insert=e);return i.object(t)&&Object.keys(t).length>0&&(r.attributes=t),this.push(r)},s.prototype.delete=function(e){return e<=0?this:this.push({delete:e})},s.prototype.retain=function(e,t){if(e<=0)return this;var r={retain:e};return i.object(t)&&Object.keys(t).length>0&&(r.attributes=t),this.push(r)},s.prototype.push=function(e){var t=this.ops.length,r=this.ops[t-1];if(e=f.clone(e),i.object(r)){if(i.number(e.delete)&&i.number(r.delete))return this.ops[t-1]={delete:r.delete+e.delete},this;if(i.number(r.delete)&&(i.string(e.insert)||i.number(e.insert))&&(t-=1,r=this.ops[t-1],!i.object(r)))return this.ops.unshift(e),this;if(i.equal(e.attributes,r.attributes)){if(i.string(e.insert)&&i.string(r.insert))return this.ops[t-1]={insert:r.insert+e.insert},i.object(e.attributes)&&(this.ops[t-1].attributes=e.attributes),this;if(i.number(e.retain)&&i.number(r.retain))return this.ops[t-1]={retain:r.retain+e.retain},i.object(e.attributes)&&(this.ops[t-1].attributes=e.attributes),this}}return this.ops.splice(t,0,e),this},s.prototype.chop=function(){var e=this.ops[this.ops.length-1];return e&&e.retain&&!e.attributes&&this.ops.pop(),this},s.prototype.length=function(){return this.ops.reduce(function(e,t){return e+f.length(t)},0)},s.prototype.slice=function(e,t){e=e||0,i.number(t)||(t=1/0);for(var r=new s,o=f.iterator(this.ops),a=0;a<t&&o.hasNext();){var c;a<e?c=o.next(e-a):(c=o.next(t-a),r.push(c)),a+=f.length(c)}return r},s.prototype.compose=function(e){var t=f.iterator(this.ops),r=f.iterator(e.ops);for(this.ops=[];t.hasNext()||r.hasNext();)if(r.peekType()==="insert")this.push(r.next());else if(t.peekType()==="delete")this.push(t.next());else{var o=Math.min(t.peekLength(),r.peekLength()),a=t.next(o),c=r.next(o);if(i.number(c.retain)){var l={};i.number(a.retain)?l.retain=o:l.insert=a.insert;var h=f.attributes.compose(a.attributes,c.attributes,i.number(a.retain));h&&(l.attributes=h),this.push(l)}else i.number(c.delete)&&i.number(a.retain)&&this.push(c)}return this.chop()},s.prototype.diff=function(e){var t=[this.ops,e.ops].map(function(l){return l.map(function(h){if(i.string(h.insert))return h.insert;if(i.number(h.insert))return u;var p=l===e.ops?"on":"with";throw new Error("diff() called "+p+" non-document")}).join("")}),r=n(t[0],t[1]),o=f.iterator(this.ops),a=f.iterator(e.ops),c=new s;return r.forEach(function(l){for(var h=l[1].length;h>0;){var p=0;switch(l[0]){case n.INSERT:p=Math.min(a.peekLength(),h),c.push(a.next(p));break;case n.DELETE:p=Math.min(h,o.peekLength()),o.next(p),c.delete(p);break;case n.EQUAL:p=Math.min(o.peekLength(),a.peekLength(),h);var x=o.next(p),b=a.next(p);x.insert===b.insert?c.retain(p,f.attributes.diff(x.attributes,b.attributes)):c.push(b).delete(p);break}h-=p}}),c.chop()},s.prototype.transform=function(e,t){if(t=!!t,i.number(e))return this.transformPosition(e,t);for(var r=f.iterator(this.ops),o=f.iterator(e.ops),a=new s;r.hasNext()||o.hasNext();)if(r.peekType()==="insert"&&(t||o.peekType()!=="insert"))a.retain(f.length(r.next()));else if(o.peekType()==="insert")a.push(o.next());else{var c=Math.min(r.peekLength(),o.peekLength()),l=r.next(c),h=o.next(c);if(l.delete)continue;h.delete?a.push(h):a.retain(c,f.attributes.transform(l.attributes,h.attributes,t))}return a.chop()},s.prototype.transformPosition=function(e,t){t=!!t;for(var r=f.iterator(this.ops),o=0;r.hasNext()&&o<=e;){var a=r.peekLength(),c=r.peekType();if(r.next(),c==="delete"){e-=Math.min(a,e-o);continue}else c==="insert"&&(o<e||!t)&&(e+=a);o+=a}return e},m=s,m}var j,T;function w(){if(T)return j;T=1;var n=D();return j={Delta:n,name:"rich-text",uri:"http://sharejs.org/types/rich-text/v1",create:function(i){return new n(i)},apply:function(i,f){return i=new n(i),f=new n(f),i.compose(f)},compose:function(i,f){return i=new n(i),f=new n(f),i.compose(f)},diff:function(i,f){return i=new n(i),f=new n(f),i.diff(f)},transform:function(i,f,u){return i=new n(i),f=new n(f),f.transform(i,u==="left")}},j}var y,q;function A(){return q||(q=1,y=w()),y}export{A as r};
